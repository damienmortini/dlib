<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: element-input-connector-linkable/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: element-input-connector-linkable/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import InputConnectorElement from '../input-connector/index.js';

const CONNECTORS = new Set();

let activeConnector = null;

/**
 * Handle connector elements linking
 */
class InputConnectorLinkableElement extends InputConnectorElement {
  constructor() {
    super();

    this.shadowRoot.querySelector('slot style').insertAdjacentHTML('beforeend', `
      :host {
        cursor: pointer;
        touch-action: none;
      }
      :host(:hover) {
        background: red;
      }
      :host(:focus-within) {
        background: green;
      }
      :host([connected]) {
        background: orange;
      }
    `);

    this.addEventListener('pointerdown', this._onPointerDown);

    this._onWindowPointerUpBinded = this._onWindowPointerUp.bind(this);
  }

  connectedCallback() {
    super.connectedCallback();
    CONNECTORS.add(this);
    this.addEventListener('connected', this._onConnected);
  }

  disconnectedCallback() {
    this.removeEventListener('connected', this._onConnected);
    window.removeEventListener('pointerup', this._onWindowPointerUpBinded);
    CONNECTORS.delete(this);
    super.disconnectedCallback();
  }

  _onConnected(event) {
    this.dispatchEvent(new CustomEvent('connectorlink', {
      composed: true,
      bubbles: true,
      detail: {
        input: this,
        output: event.detail.output,
      },
    }));
  }

  _onPointerDown() {
    if (activeConnector) {
      return;
    }
    activeConnector = this;

    window.addEventListener('pointerup', this._onWindowPointerUpBinded, { passive: false });

    this.dispatchEvent(new CustomEvent('connectorlink', {
      composed: true,
      bubbles: true,
      detail: {
        input: this,
        output: undefined,
      },
    }));
  }

  _onWindowPointerUp(event) {
    if (!activeConnector) {
      return;
    }

    let hitConnector;

    for (const connector of CONNECTORS) {
      const boundingClientRect = connector.getBoundingClientRect();
      if (event.clientX > boundingClientRect.x &amp;&amp;
        event.clientX &lt; boundingClientRect.x + boundingClientRect.width &amp;&amp;
        event.clientY > boundingClientRect.y &amp;&amp;
        event.clientY &lt; boundingClientRect.y + boundingClientRect.height) {
        hitConnector = connector;
      }
    }

    if (hitConnector === activeConnector) {
      return;
    }

    window.removeEventListener('pointerup', this._onWindowPointerUpBinded);

    if (!hitConnector || (activeConnector.type === hitConnector.type &amp;&amp; hitConnector.type !== InputConnectorLinkableElement.TYPE_BOTH)) {
      activeConnector = null;
      this.dispatchEvent(new CustomEvent('connectorlink', {
        composed: true,
        bubbles: true,
        detail: {
          input: null,
          output: null,
        },
      }));
      return;
    }

    const inputConnector = activeConnector.type &amp; InputConnectorLinkableElement.TYPE_INPUT || hitConnector.type &amp; InputConnectorLinkableElement.TYPE_OUTPUT ? hitConnector : activeConnector;
    const outputConnector = inputConnector === activeConnector ? hitConnector : activeConnector;

    inputConnector.outputs.add(outputConnector);

    activeConnector = null;
  }
}

export default InputConnectorLinkableElement;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="InputConnectorElement.html">InputConnectorElement</a></li><li><a href="InputConnectorLinkableElement.html">InputConnectorLinkableElement</a></li><li><a href="LottieAnimationElement.html">LottieAnimationElement</a></li><li><a href="module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#pause">pause</a></li><li><a href="global.html#paused">paused</a></li><li><a href="global.html#play">play</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Feb 21 2020 18:10:34 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
